# üñ•Ô∏è Preview Video Monitor Pro ‚Äî Version 2.0 (2025-11-12)

## üöÄ Major Update ‚Äî Real-Time RAM-Cached Playback

This update delivers a **massive performance leap** for video playback in ComfyUI, transforming the node into a fully RAM-accelerated, 8-bit optimized video preview system.

---

### ‚ú® Highlights

#### ‚ö° Full RAM Caching
- Videos are now decoded once and fully cached in memory as 8-bit RGB frames.  
- Playback no longer depends on OpenCV‚Äôs disk streaming per frame.  
- Re-runs of the same video reuse cache instantly.

#### üé® 8-Bit Color Pipeline (was 32-bit Float)
- Replaced float32 frame storage with compact 8-bit RGB surfaces.  
- Cuts memory use by **~75%** and eliminates costly float‚Üîuint8 conversions.  
- No visible quality loss for MP4/H.264 previews.

#### üßÆ Pre-Scaling on Load
- All frames are pre-scaled to the target monitor resolution and fit mode during extraction.  
- Eliminates per-frame OpenCV resize calls during playback.

#### üß† Smart Global Cache
- Added a shared global cache keyed by video path + resolution + fit mode.  
- Cached videos persist across prompts until ComfyUI restarts.  
- Automatically bypasses re-decoding for repeated runs.

#### üß± Memory-Safe Design
- Built-in memory threshold (default: **2 GiB**) to prevent overload.  
- Large videos gracefully fall back to streaming mode with a log warning.  
- Limit adjustable via environment variable:
  ```bash
  set PREVIEWVM_MAX_CACHE_BYTES=4294967296
  
  
---

üß∞ Developer Notes

Source structure and registration unchanged ‚Äî drop-in replacement for __init__.py.

Added extensive logging for caching, FPS, and memory operations.

Safe multithreaded design using locks for global cache access.  


---

| Old Version         | v2.0 Improvement       |
| ------------------- | ---------------------- |
| Disk-based decoding | Full RAM caching       |
| 32-bit float frames | 8-bit RGB optimized    |
| Per-frame resizing  | Pre-scaled cache       |
| 8‚Äì10 FPS playback   | Smooth 24‚Äì60 FPS       |
| No cache reuse      | Smart persistent cache |


